% -----------------------------------------------------------------------
% too many math alphabets...
\usepackage{etoolbox}
% \makeatletter
% \def\new@mathgroup{\alloc@8\mathgroup\mathchardef\@cclvi}
% \patchcmd{\document@select@group}{\sixt@@n}{\@cclvi}{}{}
% \patchcmd{\select@group}{\sixt@@n}{\@cclvi}{}{}
% \makeatother

% \usepackage{luatex85}
% -----------------------------------------------------------------------
%\def\pdfpkresolution2400 % pour bbm (??)

\usepackage[T1]{fontenc}
\usepackage{microtype}
\usepackage[american]{babel}

\usepackage{upgreek}
\usepackage{paralist}
\usepackage{enumitem}
\usepackage{stmaryrd}
\usepackage{graphicx}
\usepackage{xspace,xcolor}
\usepackage{amsmath,amsfonts,amssymb,mathtools}

\newcommand\hmmax{0}
\newcommand\bmmax{1}
\usepackage{bm} % Bold Math
\usepackage{bbm} % Bold Math
% \usepackage{MnSymbol}

\usepackage{rsfso}
\usepackage{scalerel}
\usepackage{hyperref}
\usepackage{mathpartir}
\usepackage{prftree}
\usepackage{bussproofs}
\usepackage{lineno}

\usepackage{ellipsis}
\usepackage{placeins} % FloatBarrier

\usepackage{tikz}
\usepackage{tikz-cd}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations.pathmorphing,shapes}

\makeatletter
\g@addto@macro\normalsize{%
  \setlength\abovedisplayskip{5pt}
  \setlength\belowdisplayskip{5pt}
  \setlength\abovedisplayshortskip{4pt}
  \setlength\belowdisplayshortskip{4pt}
}
\makeatother

% \usepackage{nicefrac} -- a / b

% --------------------------------------------------------------------
\newcommand{\up}[1]{\textsuperscript{#1}}
% ------------------------------------------------------------------------
% \usepackage{mathpartir}

\newcommand{\todo}[1]{\textcolor{gray}{#1}}

% ------------------------------------------------------------------------
% \newtheorem{thm}{Theorem}
% \newtheorem{lem}{Lemma}
%\newtheorem{defin}[thm]{Definition}
% \newtheorem{prop}{Proposition}
% \newtheorem{cor}{Corollary}
% \newtheorem{conj}{Conjecture}

\newcommand{\rname}[1]{[{\sc #1}]}

% --------------------------------------------------------------------
\newcommand{\NN}{\mathbb{N}}
\newcommand{\ZZ}{\mathbb{Z}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\BB}{\mathbb{B}}
\newcommand{\FF}{\mathbb{F}}

\newcommand{\s}{\sigma}
\newcommand{\g}{\gamma}
\newcommand{\G}{\Gamma}
\newcommand{\D}{\Delta}
\newcommand{\state}{\sigma}
\newcommand{\mstate}{\mathfrak{s}}
\newcommand{\memstate}{\mu}
% \newcommand{\statevector}{\vec{\sigma}}
\newcommand{\statevector}{\boldsymbol{\sigma}}

\DeclarePairedDelimiter\sem{\llbracket}{\rrbracket}
\DeclarePairedDelimiter\abs{\lvert{}}{\rvert}

%\DeclarePairedDelimiter\length{\lvert{}}{\rvert}

\newcommand{\restrict}{\!\!\upharpoonright}

\newcommand{\step}[2]{#1[#2]}
\newcommand{\source}[1]{\partial_0 #1}
\newcommand{\target}[1]{\partial_1 #1}
\newcommand{\sourcecode}[1]{\overline{\partial}_0 #1}
\newcommand{\targetcode}[1]{\overline{\partial}_1 #1}
%\newcommand{\degree}[1]{\mathsf{degree}(#1)}
\newcommand{\length}[1]{\mathsf{len}(#1)}
\newcommand{\lengthl}[1]{\mathsf{len}_1(#1)}
\newcommand{\lengthr}[1]{\mathsf{len}_2(#1)}

% -------------------------------------------------------------------
\newcommand{\aborthandler}{\mathsf{Handler}}
\newcommand{\semhandler}{\mathsf{SemHandler}}
\newcommand{\errorcode}[1]{\mathsf{Error}[#1]}

\newcommand{\State}{\mathbf{State}}
\newcommand{\MStates}{\mathbf{MState}}
%\newcommand{\LogStates}{\mathbf{RStates}}
\newcommand{\SStates}{\mathbf{SState}}
\newcommand{\SepStates}{\SState}
\newcommand{\LogStates}{{\mathbf{LState}}}
\newcommand{\LStates}{\LogStates}
\newcommand{\Code}{\mathbf{Code}}
\newcommand{\Instr}{\mathbf{Instr}}
\newcommand{\RVar}{\mathbf{LockName}}
\newcommand{\Error}{\mathbf{Err}}
\newcommand{\Var}{\mathbf{Var}}
\newcommand{\Loc}{\mathbf{Loc}}
\newcommand{\Rd}{\mathbf{Rd}}
\newcommand{\rdvar}{\rho\lambda}
\newcommand{\rdvarone}{\rho_1\lambda_1}
\newcommand{\rdvartwo}{\rho_2\lambda_2}
\newcommand{\Val}{\mathbf{Val}}
\newcommand{\Traces}{\mathbf{Traces}}
\newcommand{\Trans}{\mathbf{Trans}}
\newcommand{\pullback}[1]{#1^{\ast}}

\newcommand{\returntraces}[1]{\big|\hspace{.08em}#1\hspace{.08em}\big|}
\newcommand{\sequential}{;}

\newcommand{\operationalsem}[1]{[#1]_{\text{oper}}}
\newcommand{\OperationalTraces}{\mathbf{OperationalTraces}}

\newcommand{\Nat}{\mathbb{N}}
\newcommand{\Perm}{\mathbf{Perm}}
\newcommand{\valid}{\mathcal{V}}
\newcommand{\bool}{\mathbf{bool}}

\newcommand{\Shuffles}[2]{\mathbf{Shuffles}(#1,#2)}

\newcommand{\strat}[2]{\mathtt{strat}({#1},{#2})}
\newcommand{\idstrat}{\mathtt{idstrat}}
\newcommand{\idgame}{G_{\mathrm{id}}}

\DeclareMathOperator{\STRAT}{\mathtt{STRAT}}
\DeclareMathOperator{\dom}{dom}
\DeclareMathOperator{\domC}{dom_C}
\DeclareMathOperator{\domF}{dom_F}
\DeclareMathOperator{\domprime}{dom'}
\DeclareMathOperator{\domCprime}{dom'_C}
\DeclareMathOperator{\domFprime}{dom'_F}
\DeclareMathOperator{\hdom}{hdom}
\DeclareMathOperator{\vdom}{vdom}
\DeclareMathOperator{\Option}{Option}
\DeclareMathOperator{\lock}{lock}
\DeclareMathOperator{\True}{\mathbf{true}}
\DeclareMathOperator{\False}{\mathbf{false}}

\newcommand{\reads}{\mathbf{reads}}
\newcommand{\writes}{\mathbf{writes}}

\newcommand{\domain}{\mathbbm{d}}
\newcommand{\domainC}{\domain_C}
\newcommand{\domainF}{\domain_F}
\newcommand{\domainprime}{\domain'}
\newcommand{\domainCprime}{\domain'_C}
\newcommand{\domainFprime}{\domain'_F}
\newcommand{\minstr}{\mathbbm{m}}


\newcommand{\abstrloc}{\alpha}
\newcommand{\action}[1]{\underline{#1}}

% Définition de la syntaxe du langage
\newcommand{\kw}[1]{\mathbb{\mathtt{#1}}}
\newcommand{\kwhile}{\kw{while}}
\newcommand{\kif}{\kw{if}}
\newcommand{\kthen}{\kw{then}}
\newcommand{\kelse}{\kw{else}}
\newcommand{\kalloc}{\kw{alloc}}
\newcommand{\kdispose}{\kw{dispose}}
\newcommand{\kwith}{\kw{with}}
\newcommand{\kwhen}{\kw{when}}
\newcommand{\kresource}{\kw{resource}}
\newcommand{\knop}{\kw{nop}}
\newcommand{\kskip}{\kw{skip}}
\newcommand{\kdo}{\kw{do}}
\newcommand{\ifte}[3]{\kif\: #1\: \kthen\: #2\: \kelse\: #3}
\newcommand{\while}[2]{\kwhile\: #1 \: \kdo \: #2}
\newcommand{\resource}[2]{\kresource\: #1 \: \kdo \: #2}
\newcommand{\when}[3]{\kwith\: #1 \: \kwhen\: #2 \: \kdo \: #3}
\newcommand{\alloc}[2]{#1 \coloneqq \kalloc(#2)}
\newcommand{\deref}[1]{[#1]}

% pour la sémantique non interactive
\newcommand{\kwithin}{\kw{within}}
\newcommand{\within}[2]{\kwithin\: #1 \: \kdo \: #2}

\DeclareMathOperator{\inl}{\mathbf{in_1}}
\DeclareMathOperator{\inr}{\mathbf{in_2}}

\newcommand{\powerset}{\raisebox{.15\baselineskip}{\Large\ensuremath{\wp}}}

\newcommand{\blocked}{\mathtt{blocked}}
\newcommand{\abort}{\mathtt{abort}}
\newcommand{\booleanabort}{\mathbf{abort}}

\DeclareMathOperator*{\bigsprod}{\scalerel*{\circledast}{\sum}}

%definition des graphes
%\newcommand{\GraphofStates}{\mathbf{G(States)}}
%\newcommand{\GraphofSeparatedStates}{\mathbf{G(SepStates)}}
\newcommand{\GraphofStates}{\mathbf{G(MState)}}
\newcommand{\GraphofSeparatedStates}{\mathbf{G(SState)}}
\newcommand{\SeparationGame}{\mathbf{SGame}}

\newcommand{\pargraphname}{graph of parallel compostition}

\newcommand{\AsynchGraphofStates}{\mathbf{G^{\sim}(State)}}
\newcommand{\AsynchGraphofSeparatedStates}{\mathbf{G^{\sim}(SepState)}}
\newcommand{\AsynchGraphofMachineInstructions}{\mathbf{G^{\sim}(Instr)}}
\newcommand{\AsynchGraphofMachineInstructionsfilled}{\mathbf{G^{\approx}(Instr)}}

\newcommand{\PAR}{\textsc{Par}}
\newcommand{\IF}{\textsc{If}}
\newcommand{\WHILE}{\textsc{While}}
\newcommand{\CONJ}{\textsc{Conj}}
\newcommand{\DISJ}{\textsc{Disj}}
\newcommand{\WHEN}{\textsc{With}}
\newcommand{\RES}{\textsc{Res}}
\newcommand{\AFF}{\textsc{Aff}}
\newcommand{\SEQ}{\textsc{Seq}}
\newcommand{\FRAME}{\textsc{Frame}}
\newcommand{\CONSEQ}{\textsc{Conseq}}
\newcommand{\STORE}{\textsc{Store}}
\newcommand{\LOAD}{\textsc{Load}}
\newcommand{\ALLOC}{\textsc{Alloc}}
\newcommand{\DISP}{\textsc{Disp}}


\newcommand{\ds}[0]{\preccurlyeq_S}
\newcommand{\fv}{\mathrm{fv}}

\newcommand{\defpred}{\mathrm{def}}

\DeclareMathOperator{\own}{Own}

\newcommand{\emp}{\mathbf{emp}}

\newcommand\eqdef{\stackrel{\mathclap{\normalfont\mbox{\tiny{def}}}}{=}}

% --------------------------------------------------------------------
\renewcommand{\O}{\mathcal{O}}

\newcommand{\triple}[4]{#1 \vdash\{#2\} \, #3 \, \{#4\}}
\newcommand{\triplestd}{\triple{\G}{P}{C}{Q}}

% Partial maps notations
\newcommand{\parfinmap}{\rightharpoonup_{\mathit{fin}}}
\newcommand{\extmap}[3]{#1 \uplus{} [{#2} \mapsto{} {#3}]}
\newcommand{\updmap}[3]{#1[#2 \mapsto #3]}
\newcommand{\remmap}[2]{#1 \setminus #2}


\newcommand\evalexpr[3]{#1(#2) = #3}

\newcommand{\kArrowLength}{1cm}

\newcommand{\redto}[3]{%
    \begin{tikzcd}[ampersand replacement=\&, column sep=\kArrowLength]%
      {#1} \arrow[r, rightsquigarrow, "#2"] \& {#3}%
    \end{tikzcd}%
  }

\newcommand{\returnto}[3]{%
    \begin{tikzcd}[ampersand replacement=\&, column sep=\kArrowLength]%
      {#1} \arrow[r, rightsquigarrow, tail, "#2"] \& {#3}%
    \end{tikzcd}%
  }

\newcommand{\errorto}[3]{%
    \begin{tikzcd}[ampersand replacement=\&, column sep=\kArrowLength]%
%      {#1} \arrow[r, decorate, decoration={snake}, "#2"] \& {#3}%
     {#1} \arrow[r, double,  rightsquigarrow, -implies, "#2"] \& {#3}%
    \end{tikzcd}%
  }
  

% ----------- section semantics --------------------------
\DeclareMathOperator{\simple}{\mathbf{Te}}
\DeclareMathOperator{\simplestuck}{\mathbf{Ab}}
%\DeclareMathOperator{\hide}{hide}
\newcommand{\hide}[1]{\mathsf{hide}[#1]}
\newcommand{\inside}[1]{\mathsf{inside}[#1]}
\newcommand{\whentrue}[1]{\mathsf{whentrue}[#1]}
\newcommand{\whenfalse}[1]{\mathsf{whenfalse}[#1]}
\newcommand{\whenabort}[1]{\mathsf{whenabort}[#1]}
\newcommand{\whensimple}[1]{\mathsf{when}[#1]}

% ----------- section proof ------------------------------
\newcommand{\kparproj}{\mathbf{proj}}
\newcommand{\parproj}[1]{\kparproj(#1)}
\newcommand{\parprojl}{\mathbf{proj}_1}
\newcommand{\parprojr}{\mathbf{proj}_2}
\newcommand{\splice}[1] {\mathbf{splice}(#1)}
\newcommand{\splicel}[1] {\mathbf{splice}_1(#1)}
\newcommand{\splicer}[1] {\mathbf{splice}_2(#1)}

\newcommand{\verticalproof}[1]{\begin{array}{c}#1\vspace{-.5em}\\ \vdots\end{array}}

\newcommand{\Board}[1]{\mathsf{Board}_{#1}}
\newcommand{\Polarity}[1]{\mathsf{Pol}_{#1}}
\newcommand{\Plays}[1]{\mathsf{Plays}_{#1}}
\newcommand{\Initial}[1]{\mathsf{Init}_{#1}}

\newcommand{\play}{p} %{\mathsf{p}}
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End: